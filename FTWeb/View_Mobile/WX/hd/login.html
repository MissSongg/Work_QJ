<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>登录</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/app.css">
	

</head>
<style>
.mui-bar {
    background-color: rgba(75, 66, 66, 0.82);
}

.mui-title {
    color: #fff;
}

::input-placeholder {
    color: #242020;
}

::-webkit-input-placeholder {
    color: #242020;
}

.mui-title .mui-segmented-control {
    top: 3px;
    border: none;
    height: 43px;
}
</style>

<body class="bodybgLogin" ms-controller="loginview">
    <header class="mui-bar mui-bar-nav">
        <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
        <h1 class="mui-title">
            <div id="segmentedControl" class="mui-segmented-control">
              <a class="mui-control-item mui-active" href="#hnlLogin">登录</a>
              <a class="mui-control-item" href="#hnlRegist">注册 </a>
           </div>
        </h1>
    </header>
    <div id="loginBg">
        <div id="hnlLogin" class="mui-control-content mui-active">
            <input type="text" id="phone" name="" placeholder="手机号" maxlength="11" ms-duplex="@UsrData.mobphone">
            <input type="password" id="userPwd" name="" placeholder="密码" ms-duplex="@UsrData.Pasd"> 
            <!-- <a class="forgetpw right" href="#">忘记密码？</a> -->
            <a class="btnLogin1 marginTop" ms-click="@Login()">登录</a>
        </div>
        <div class="mui-control-content" id="hnlRegist">
            <input type="text" id="phone2" name="" placeholder="手机号" maxlength="11" ms-duplex="@RegData.mobphone">
            <input type="password" id="userPwd2" name="" placeholder="密码" ms-duplex="@RegData.Pasd">
            <input type="password" id="userPwd3" name="" placeholder="确认密码" ms-duplex="@RegData.Pasd1">
            <!-- <a class="forgetpw right" href="#">忘记密码？</a> -->
            <a class="btnLogin2 marginTop" ms-click="@Reg()">注册</a>
        </div>
    </div>
</body>
    <script src="js/mui.min.js"></script>
<script type="text/javascript" src="js/jquery-1.12.2.min.js"></script>
<script src="//cdn.bootcss.com/avalon.js/2.2.5/avalon.js"></script>
<script src="../../JS/ComFunJS.js"></script>
<script>

    var model = avalon.define({
        $id: "loginview",
        UsrData: { "mobphone": "", "Pasd": "" },
        RegData: { "mobphone": "", "Pasd": "", "Pasd1": "" },
        rurl: ComFunJS.getQueryString("rurl"),
        Login: function () {
            if (!model.UsrData.mobphone || !model.UsrData.Pasd) {
                alert("请输入手机号和密码");
                return;
            }
            //请输入手机号和密码

            if (!checkPhone(model.UsrData.mobphone)) {
                alert("手机号格式不正确");
                return;
            }
            $.getJSON("/API/WXAPI2.ashx?Action=YXHD_LOGIN", { P1: model.UsrData.mobphone, P2: model.UsrData.Pasd }, function (r) {
                if (r.ErrorMsg == "") {
                    alert("登录成功");
                    ComFunJS.setCookie("wxuser", r.Result);
                    if (model.rurl) {
                        window.location = model.rurl;
                    } else {
                        window.location = "index.html";
                    }

                } else {
                    alert(r.ErrorMsg);
                }
            })
        },
        Reg: function () {
            if (!model.RegData.mobphone || !model.RegData.Pasd || !model.RegData.Pasd1) {
                alert("请输入手机号,密码和确认密码");
                return;
            }
            //请输入手机号和密码

            if (!checkPhone(model.RegData.mobphone)) {
                alert("手机号格式不正确");
                return;
            }

            if(model.RegData.Pasd!=model.RegData.Pasd1)
            {
                alert("两次密码不一致");
                return;
            }
            $.getJSON("/API/WXAPI2.ashx?Action=YXHD_REGISTER", { P1: model.RegData.mobphone, P2: model.RegData.Pasd }, function (r) {
                if (r.ErrorMsg == "") {
                    alert("注册成功,请登录");
                   
                } else {
                    alert(r.ErrorMsg);
                }
            })

        }
    })




    function checkPhone(phone) {
        var phone = $.trim(phone);
        if (!(/^1(3|4|5|7|8)\d{9}$/.test(phone))) {
            return false;
        } else {
            return true;
        }
    }

   //alert(document.documentElement.clientHeight+"px");
    document.getElementsByTagName('body')[0].style.height = window.innerHeight+'px'; 

</script>

</html>
